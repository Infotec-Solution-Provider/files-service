generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("FILES_DATABASE_URL")
}

model File {
  id              Int         @id @default(autoincrement())
  public_id       String      @unique @default(nanoid(21)) @db.Char(21)
  id_storage      String      @db.VarChar(36)
  name            String      @db.VarChar(255)
  mime_type       String      @db.VarChar(255)
  size            Int
  content_hash    String?     @db.Char(64)
  dir_type        FileDirType
  storage_id      Int
  created_at      DateTime    @default(now())
  last_accessed_at DateTime?
  waba_media_id   String?     @db.VarChar(255)

  storage Storage @relation(fields: [storage_id], references: [id], onUpdate: Restrict, map: "FK_FILE_STORAGE")

  @@unique([storage_id, dir_type, content_hash], map: "UQ_FILES_STORAGE_DIR_HASH")
  @@map("files")
}

model Storage {
  id         Int             @id @default(autoincrement())
  instance   String          @db.VarChar(30)
  type       FileStorageType
  client_url String?
  timeout    Int?
  token      String?
  is_default Boolean         @default(false)

  files File[]

  @@map("storages")
}

enum FileStorageType {
  server
  client
}

enum FileDirType {
  public
  models
}
